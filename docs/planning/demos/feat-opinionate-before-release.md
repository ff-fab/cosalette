# Pre-release polish: root devices, log rotation, reconnect backoff

*2026-02-21T09:32:09Z by Showboat 0.5.0*

Three features implemented before initial release: (1) Root device support — omit device name from decorators to publish at root-level MQTT topics ({prefix}/state), ideal for single-device apps. (2) Configurable log file rotation size — max_file_size_mb in LoggingSettings (default 10 MB). (3) Exponential reconnect backoff with ±20% jitter for MQTT connections, capped at reconnect_max_interval (default 300s).

```bash
cd /workspace && task test:unit 2>&1 | grep -E 'passed|PASSED|Coverage|Result'
```

```output
packages/tests/unit/test_app.py::TestHeartbeatIntervalValidation::test_rejects_zero_interval PASSED [  0%]
packages/tests/unit/test_app.py::TestHeartbeatIntervalValidation::test_rejects_negative_interval PASSED [  0%]
packages/tests/unit/test_app.py::TestHeartbeatIntervalValidation::test_accepts_positive_interval PASSED [  0%]
packages/tests/unit/test_app.py::TestHeartbeatIntervalValidation::test_accepts_none_interval PASSED [  0%]
packages/tests/unit/test_app.py::TestDeviceDecorator::test_registers_device_function PASSED [  1%]
packages/tests/unit/test_app.py::TestDeviceDecorator::test_returns_original_function PASSED [  1%]
packages/tests/unit/test_app.py::TestDeviceDecorator::test_duplicate_device_name_raises PASSED [  1%]
packages/tests/unit/test_app.py::TestDeviceDecorator::test_duplicate_across_device_and_telemetry_raises PASSED [  1%]
packages/tests/unit/test_app.py::TestDeviceDecorator::test_multiple_distinct_devices PASSED [  2%]
packages/tests/unit/test_app.py::TestTelemetryDecorator::test_registers_telemetry_function PASSED [  2%]
packages/tests/unit/test_app.py::TestTelemetryDecorator::test_returns_original_function PASSED [  2%]
packages/tests/unit/test_app.py::TestTelemetryDecorator::test_duplicate_name_raises PASSED [  2%]
packages/tests/unit/test_app.py::TestTelemetryDecorator::test_zero_interval_raises PASSED [  3%]
packages/tests/unit/test_app.py::TestTelemetryDecorator::test_negative_interval_raises PASSED [  3%]
packages/tests/unit/test_app.py::TestLifespan::test_default_lifespan_is_noop PASSED [  3%]
packages/tests/unit/test_app.py::TestLifespan::test_custom_lifespan_stored PASSED [  3%]
packages/tests/unit/test_app.py::TestAdapterRegistration::test_registers_adapter PASSED [  4%]
packages/tests/unit/test_app.py::TestAdapterRegistration::test_duplicate_port_type_raises PASSED [  4%]
packages/tests/unit/test_app.py::TestAdapterRegistration::test_dry_run_variant_stored PASSED [  4%]
packages/tests/unit/test_app.py::TestRunAsync::test_device_function_runs PASSED [  4%]
packages/tests/unit/test_app.py::TestRunAsync::test_telemetry_function_polls_and_publishes PASSED [  4%]
packages/tests/unit/test_app.py::TestRunAsync::test_lifespan_startup_runs PASSED [  5%]
packages/tests/unit/test_app.py::TestRunAsync::test_lifespan_teardown_runs PASSED [  5%]
packages/tests/unit/test_app.py::TestRunAsync::test_lifespan_happy_path PASSED [  5%]
packages/tests/unit/test_app.py::TestRunAsync::test_lifespan_startup_error_prevents_device_launch PASSED [  5%]
packages/tests/unit/test_app.py::TestRunAsync::test_lifespan_teardown_error_logged_not_raised PASSED [  6%]
packages/tests/unit/test_app.py::TestRunAsync::test_lifespan_receives_correct_app_context PASSED [  6%]
packages/tests/unit/test_app.py::TestRunAsync::test_lifespan_aexit_receives_exception_info PASSED [  6%]
packages/tests/unit/test_app.py::TestRunAsync::test_lifespan_aexit_receives_none_on_clean_shutdown PASSED [  6%]
packages/tests/unit/test_app.py::TestRunAsync::test_no_lifespan_noop_works PASSED [  7%]
packages/tests/unit/test_app.py::TestRunAsync::test_device_error_isolation PASSED [  7%]
packages/tests/unit/test_app.py::TestRunAsync::test_telemetry_error_resilience PASSED [  7%]
packages/tests/unit/test_app.py::TestRunAsync::test_command_routing PASSED [  7%]
packages/tests/unit/test_app.py::TestRunAsync::test_adapter_resolution_in_device PASSED [  8%]
packages/tests/unit/test_app.py::TestRunAsync::test_dry_run_adapter_swap PASSED [  8%]
packages/tests/unit/test_app.py::TestRunAsync::test_multiple_devices_run_concurrently PASSED [  8%]
packages/tests/unit/test_app.py::TestRunAsync::test_health_reporter_publishes_availability PASSED [  8%]
packages/tests/unit/test_app.py::TestRunAsync::test_graceful_shutdown_sequence PASSED [  8%]
packages/tests/unit/test_app.py::TestRunAsync::test_mqtt_subscriptions_for_devices PASSED [  9%]
packages/tests/unit/test_app.py::TestRunAsync::test_lifespan_teardown_runs_after_device_cancellation PASSED [  9%]
packages/tests/unit/test_app.py::TestRunAsync::test_command_error_published_to_mqtt PASSED [  9%]
packages/tests/unit/test_app.py::TestRunAsync::test_command_error_publication_failure_is_swallowed PASSED [  9%]
packages/tests/unit/test_app.py::TestRunAsync::test_device_command_handler_error_is_logged PASSED [ 10%]
packages/tests/unit/test_app.py::TestRunAsync::test_topic_prefix_override_from_settings PASSED [ 10%]
packages/tests/unit/test_app.py::TestRunAsync::test_topic_prefix_falls_back_to_app_name PASSED [ 10%]
packages/tests/unit/test_app.py::TestRunAsync::test_client_id_auto_generated_when_empty PASSED [ 10%]
packages/tests/unit/test_app.py::TestRunAsync::test_client_id_preserved_when_configured PASSED [ 11%]
packages/tests/unit/test_app.py::TestRunAsync::test_heartbeat_published_on_startup PASSED [ 11%]
packages/tests/unit/test_app.py::TestRunAsync::test_periodic_heartbeat_publishes_multiple_times PASSED [ 11%]
packages/tests/unit/test_app.py::TestRunAsync::test_heartbeat_disabled_with_none_interval PASSED [ 11%]
packages/tests/unit/test_app.py::TestAdapterFactoryCallable::test_factory_callable_registration PASSED [ 12%]
packages/tests/unit/test_app.py::TestAdapterFactoryCallable::test_factory_callable_with_constructor_args PASSED [ 12%]
packages/tests/unit/test_app.py::TestAdapterFactoryCallable::test_factory_callable_for_dry_run PASSED [ 12%]
packages/tests/unit/test_app.py::TestAdapterFactoryCallable::test_class_impl_factory_dry_run PASSED [ 12%]
packages/tests/unit/test_app.py::TestAdapterFactoryCallable::test_factory_impl_class_dry_run PASSED [ 12%]
packages/tests/unit/test_app.py::TestAdapterFactoryCallable::test_factory_impl_resolves_in_normal_mode PASSED [ 13%]
packages/tests/unit/test_app.py::TestAdapterFactoryCallable::test_string_impl_factory_dry_run PASSED [ 13%]
packages/tests/unit/test_app.py::TestMqttProtocolConformance::test_mqtt_client_satisfies_lifecycle PASSED [ 13%]
packages/tests/unit/test_app.py::TestMqttProtocolConformance::test_mqtt_client_satisfies_message_handler PASSED [ 13%]
packages/tests/unit/test_app.py::TestMqttProtocolConformance::test_mock_mqtt_client_satisfies_message_handler PASSED [ 14%]
packages/tests/unit/test_app.py::TestMqttProtocolConformance::test_mock_mqtt_client_does_not_satisfy_lifecycle PASSED [ 14%]
packages/tests/unit/test_app.py::TestMqttProtocolConformance::test_null_mqtt_client_does_not_satisfy_lifecycle PASSED [ 14%]
packages/tests/unit/test_app.py::TestMqttProtocolConformance::test_null_mqtt_client_does_not_satisfy_message_handler PASSED [ 14%]
packages/tests/unit/test_app.py::TestMqttProtocolConformance::test_all_three_satisfy_mqtt_port PASSED [ 15%]
packages/tests/unit/test_app.py::TestSignatureInjection::test_device_zero_arg_handler PASSED [ 15%]
packages/tests/unit/test_app.py::TestSignatureInjection::test_telemetry_zero_arg_handler PASSED [ 15%]
packages/tests/unit/test_app.py::TestSignatureInjection::test_device_settings_only_handler PASSED [ 15%]
packages/tests/unit/test_app.py::TestSignatureInjection::test_device_logger_only_handler PASSED [ 16%]
packages/tests/unit/test_app.py::TestSignatureInjection::test_device_multi_arg_handler PASSED [ 16%]
packages/tests/unit/test_app.py::TestSignatureInjection::test_device_with_adapter_injection PASSED [ 16%]
packages/tests/unit/test_app.py::TestSignatureInjection::test_device_missing_annotation_raises PASSED [ 16%]
packages/tests/unit/test_app.py::TestSignatureInjection::test_telemetry_missing_annotation_raises PASSED [ 16%]
packages/tests/unit/test_app.py::TestSignatureInjection::test_existing_ctx_style_still_works PASSED [ 17%]
packages/tests/unit/test_app.py::TestRootDevice::test_telemetry_name_defaults_to_function_name PASSED [ 17%]
packages/tests/unit/test_app.py::TestRootDevice::test_command_name_defaults_to_function_name PASSED [ 17%]
packages/tests/unit/test_app.py::TestRootDevice::test_device_name_defaults_to_function_name PASSED [ 17%]
packages/tests/unit/test_app.py::TestRootDevice::test_second_root_device_raises PASSED [ 18%]
packages/tests/unit/test_app.py::TestRootDevice::test_named_device_still_works PASSED [ 18%]
packages/tests/unit/test_app.py::TestRootDevice::test_mixing_root_and_named_logs_warning PASSED [ 18%]
packages/tests/unit/test_app.py::TestRootDevice::test_mixing_named_after_root_logs_warning PASSED [ 18%]
packages/tests/unit/test_app.py::TestRootDevice::test_root_telemetry_publishes_to_prefix_state PASSED [ 19%]
packages/tests/unit/test_app.py::TestRootDevice::test_bare_device_decorator_raises_type_error PASSED [ 19%]
packages/tests/unit/test_app.py::TestRootDevice::test_bare_command_decorator_raises_type_error PASSED [ 19%]
packages/tests/unit/test_app.py::TestRootDevice::test_root_command_receives_on_prefix_set PASSED [ 19%]
packages/tests/unit/test_app.py::TestRootDevice::test_root_device_lifecycle_uses_prefix_availability PASSED [ 20%]
packages/tests/unit/test_app_run.py::TestRunSyncEntrypoint::test_run_starts_and_stops_cleanly PASSED [ 20%]
packages/tests/unit/test_app_run.py::TestRunSyncEntrypoint::test_run_executes_device_function PASSED [ 20%]
packages/tests/unit/test_app_run.py::TestRunSyncEntrypoint::test_run_with_mock_mqtt PASSED [ 20%]
packages/tests/unit/test_app_run.py::TestRunSyncEntrypoint::test_run_suppresses_keyboard_interrupt PASSED [ 20%]
packages/tests/unit/test_app_run.py::TestRunSyncEntrypoint::test_run_propagates_system_exit PASSED [ 21%]
packages/tests/unit/test_app_run.py::TestRunSyncEntrypoint::test_run_propagates_runtime_errors PASSED [ 21%]
packages/tests/unit/test_app_run.py::TestRunSyncEntrypoint::test_run_passes_all_kwargs_to_run_async PASSED [ 21%]
packages/tests/unit/test_app_run.py::TestRunSyncEntrypoint::test_run_with_no_args_calls_run_async_with_nones PASSED [ 21%]
packages/tests/unit/test_app_run.py::TestRunSignalHandling::test_sigterm_triggers_shutdown PASSED [ 22%]
packages/tests/unit/test_app_run.py::TestRunSignalHandling::test_sigint_triggers_shutdown PASSED [ 22%]
packages/tests/unit/test_app_run.py::TestCliMethod::test_cli_method_builds_and_invokes_typer PASSED [ 22%]
packages/tests/unit/test_cli.py::TestVersionFlag::test_version_prints_name_and_version PASSED [ 22%]
packages/tests/unit/test_cli.py::TestHelpFlag::test_help_shows_description_and_powered_by PASSED [ 23%]
packages/tests/unit/test_cli.py::TestHelpFlag::test_help_shows_all_expected_options PASSED [ 23%]
packages/tests/unit/test_cli.py::TestDryRunFlag::test_dry_run_flag_sets_app_dry_run PASSED [ 23%]
packages/tests/unit/test_cli.py::TestDryRunFlag::test_default_dry_run_is_false PASSED [ 23%]
packages/tests/unit/test_cli.py::TestEnvFileFlag::test_env_file_flag_changes_settings_source PASSED [ 24%]
packages/tests/unit/test_cli.py::TestEnvFileFlag::test_default_env_file_is_dot_env PASSED [ 24%]
packages/tests/unit/test_cli.py::TestLogLevelOverride::test_log_level_overrides_settings PASSED [ 24%]
packages/tests/unit/test_cli.py::TestLogLevelOverride::test_invalid_log_level_returns_error PASSED [ 24%]
packages/tests/unit/test_cli.py::TestLogFormatOverride::test_log_format_overrides_settings PASSED [ 24%]
packages/tests/unit/test_cli.py::TestLogFormatOverride::test_invalid_log_format_returns_error PASSED [ 25%]
packages/tests/unit/test_cli.py::TestExitCodes::test_clean_run_exits_zero PASSED [ 25%]
packages/tests/unit/test_cli.py::TestExitCodes::test_config_error_exits_one PASSED [ 25%]
packages/tests/unit/test_cli.py::TestExitCodes::test_exit_code_constants_have_expected_values PASSED [ 25%]
packages/tests/unit/test_cli.py::TestExitCodes::test_runtime_error_exits_three PASSED [ 26%]
packages/tests/unit/test_clock.py::TestSystemClock::test_satisfies_clock_port_protocol PASSED [ 26%]
packages/tests/unit/test_clock.py::TestSystemClock::test_now_returns_float PASSED [ 26%]
packages/tests/unit/test_clock.py::TestSystemClock::test_now_is_monotonically_non_decreasing PASSED [ 26%]
packages/tests/unit/test_clock.py::TestClockPortProtocol::test_custom_class_satisfies_protocol PASSED [ 27%]
packages/tests/unit/test_clock.py::TestClockPortProtocol::test_class_without_now_does_not_satisfy PASSED [ 27%]
packages/tests/unit/test_command.py::TestCommandRegistration::test_command_registers_handler PASSED [ 27%]
packages/tests/unit/test_command.py::TestCommandRegistration::test_command_rejects_duplicate_name PASSED [ 27%]
packages/tests/unit/test_command.py::TestCommandRegistration::test_command_rejects_name_collision_with_device PASSED [ 28%]
packages/tests/unit/test_command.py::TestCommandRegistration::test_command_rejects_name_collision_with_telemetry PASSED [ 28%]
packages/tests/unit/test_command.py::TestCommandRegistration::test_device_rejects_collision_with_command PASSED [ 28%]
packages/tests/unit/test_command.py::TestCommandRegistration::test_telemetry_rejects_collision_with_command PASSED [ 28%]
packages/tests/unit/test_command.py::TestCommandRegistration::test_command_builds_injection_plan_excluding_topic_payload PASSED [ 28%]
packages/tests/unit/test_command.py::TestCommandRegistration::test_command_returns_original_function PASSED [ 29%]
packages/tests/unit/test_command.py::TestCommandRegistration::test_command_mqtt_params_both_declared PASSED [ 29%]
packages/tests/unit/test_command.py::TestCommandRegistration::test_command_mqtt_params_payload_only PASSED [ 29%]
packages/tests/unit/test_command.py::TestCommandRegistration::test_command_mqtt_params_topic_only PASSED [ 29%]
packages/tests/unit/test_command.py::TestCommandRegistration::test_command_mqtt_params_neither PASSED [ 30%]
packages/tests/unit/test_command.py::TestCommandRouting::test_command_handler_receives_topic_and_payload PASSED [ 30%]
packages/tests/unit/test_command.py::TestCommandRouting::test_command_handler_return_dict_publishes_state PASSED [ 30%]
packages/tests/unit/test_command.py::TestCommandRouting::test_command_handler_return_none_skips_publish PASSED [ 30%]
packages/tests/unit/test_command.py::TestCommandRouting::test_command_handler_with_injected_context PASSED [ 31%]
packages/tests/unit/test_command.py::TestCommandRouting::test_command_handler_with_injected_adapter PASSED [ 31%]
packages/tests/unit/test_command.py::TestCommandRouting::test_command_handler_error_published_to_mqtt PASSED [ 31%]
packages/tests/unit/test_command.py::TestCommandRouting::test_command_handler_error_publication_failure_swallowed PASSED [ 31%]
packages/tests/unit/test_command.py::TestCommandRouting::test_command_availability_published_on_startup PASSED [ 32%]
packages/tests/unit/test_command.py::TestCommandRouting::test_command_availability_offline_on_shutdown PASSED [ 32%]
packages/tests/unit/test_command.py::TestCommandRouting::test_command_coexists_with_device PASSED [ 32%]
packages/tests/unit/test_command.py::TestCommandRouting::test_command_handler_payload_only_receives_payload PASSED [ 32%]
packages/tests/unit/test_command.py::TestCommandRouting::test_command_handler_neither_topic_nor_payload PASSED [ 32%]
packages/tests/unit/test_command.py::TestCommandRouting::test_command_handler_topic_only_receives_topic PASSED [ 33%]
packages/tests/unit/test_command.py::TestCommandInjection::test_injection_plan_skips_mqtt_params PASSED [ 33%]
packages/tests/unit/test_command.py::TestCommandInjection::test_injection_plan_without_mqtt_params_unchanged PASSED [ 33%]
packages/tests/unit/test_command.py::TestCommandInjection::test_command_handler_zero_extra_params PASSED [ 33%]
packages/tests/unit/test_command.py::TestCommandInjection::test_injection_plan_rejects_unannotated_param PASSED [ 34%]
packages/tests/unit/test_context.py::TestDeviceContextProperties::test_name_returns_registered_name PASSED [ 34%]
packages/tests/unit/test_context.py::TestDeviceContextProperties::test_settings_returns_injected_settings PASSED [ 34%]
packages/tests/unit/test_context.py::TestDeviceContextProperties::test_clock_returns_injected_clock PASSED [ 34%]
packages/tests/unit/test_context.py::TestDeviceContextProperties::test_shutdown_requested_false_initially PASSED [ 35%]
packages/tests/unit/test_context.py::TestDeviceContextProperties::test_shutdown_requested_true_after_event_set PASSED [ 35%]
packages/tests/unit/test_context.py::TestDeviceContextProperties::test_command_handler_none_initially PASSED [ 35%]
packages/tests/unit/test_context.py::TestPublishState::test_publishes_json_to_state_topic PASSED [ 35%]
packages/tests/unit/test_context.py::TestPublishState::test_retain_false_override PASSED [ 36%]
packages/tests/unit/test_context.py::TestPublishState::test_payload_is_json_serialised PASSED [ 36%]
packages/tests/unit/test_context.py::TestPublish::test_publishes_to_channel_topic PASSED [ 36%]
packages/tests/unit/test_context.py::TestPublish::test_retain_and_qos_passthrough PASSED [ 36%]
packages/tests/unit/test_context.py::TestSleep::test_sleep_completes_normally PASSED [ 36%]
packages/tests/unit/test_context.py::TestSleep::test_sleep_returns_early_on_shutdown PASSED [ 37%]
packages/tests/unit/test_context.py::TestSleep::test_sleep_does_not_raise_on_shutdown PASSED [ 37%]
packages/tests/unit/test_context.py::TestOnCommand::test_registers_handler PASSED [ 37%]
packages/tests/unit/test_context.py::TestOnCommand::test_returns_handler_for_decorator_use PASSED [ 37%]
packages/tests/unit/test_context.py::TestOnCommand::test_decorator_syntax PASSED [ 38%]
packages/tests/unit/test_context.py::TestOnCommand::test_raises_on_duplicate_registration PASSED [ 38%]
packages/tests/unit/test_context.py::TestAdapter::test_resolves_registered_adapter PASSED [ 38%]
packages/tests/unit/test_context.py::TestAdapter::test_raises_lookup_error_for_unregistered PASSED [ 38%]
packages/tests/unit/test_context.py::TestAdapter::test_generic_return_type PASSED [ 39%]
packages/tests/unit/test_context.py::TestAppContext::test_settings_property PASSED [ 39%]
packages/tests/unit/test_context.py::TestAppContext::test_adapter_resolves_correctly PASSED [ 39%]
packages/tests/unit/test_context.py::TestAppContext::test_adapter_raises_for_missing_port PASSED [ 39%]
packages/tests/unit/test_context.py::TestImportString::test_imports_stdlib_class PASSED [ 40%]
packages/tests/unit/test_context.py::TestImportString::test_raises_value_error_for_missing_colon PASSED [ 40%]
packages/tests/unit/test_context.py::TestImportString::test_raises_value_error_for_multiple_colons PASSED [ 40%]
packages/tests/unit/test_context.py::TestImportString::test_raises_import_error_for_nonexistent_module PASSED [ 40%]
packages/tests/unit/test_context.py::TestImportString::test_raises_attribute_error_for_nonexistent_class PASSED [ 40%]
packages/tests/unit/test_context.py::TestRootDeviceTopics::test_publish_state_root_device PASSED [ 41%]
packages/tests/unit/test_context.py::TestRootDeviceTopics::test_publish_state_named_device_unchanged PASSED [ 41%]
packages/tests/unit/test_context.py::TestRootDeviceTopics::test_publish_channel_root_device PASSED [ 41%]
packages/tests/unit/test_context.py::TestRootDeviceTopics::test_publish_channel_named_device_unchanged PASSED [ 41%]
packages/tests/unit/test_errors.py::TestErrorPayload::test_construction_with_all_fields PASSED [ 42%]
packages/tests/unit/test_errors.py::TestErrorPayload::test_default_details_is_empty_dict PASSED [ 42%]
packages/tests/unit/test_errors.py::TestErrorPayload::test_device_can_be_none PASSED [ 42%]
packages/tests/unit/test_errors.py::TestErrorPayload::test_to_json_produces_valid_json_with_correct_keys PASSED [ 42%]
packages/tests/unit/test_errors.py::TestErrorPayload::test_to_json_device_none_serialised_as_null PASSED [ 43%]
packages/tests/unit/test_errors.py::TestErrorPayload::test_frozen_immutable PASSED [ 43%]
packages/tests/unit/test_errors.py::TestBuildErrorPayload::test_basic_error_fallback_type PASSED [ 43%]
packages/tests/unit/test_errors.py::TestBuildErrorPayload::test_custom_error_type_map PASSED [ 43%]
packages/tests/unit/test_errors.py::TestBuildErrorPayload::test_unknown_error_type_falls_back PASSED [ 44%]
packages/tests/unit/test_errors.py::TestBuildErrorPayload::test_device_parameter_passed_through PASSED [ 44%]
packages/tests/unit/test_errors.py::TestBuildErrorPayload::test_details_passed_through_to_payload PASSED [ 44%]
packages/tests/unit/test_errors.py::TestBuildErrorPayload::test_clock_injection_deterministic_timestamp PASSED [ 44%]
packages/tests/unit/test_errors.py::TestBuildErrorPayload::test_default_clock_timestamp_close_to_now PASSED [ 44%]
packages/tests/unit/test_errors.py::TestErrorPublisher::test_publishes_to_global_topic PASSED [ 45%]
packages/tests/unit/test_errors.py::TestErrorPublisher::test_publishes_to_device_topic_when_device_provided PASSED [ 45%]
packages/tests/unit/test_errors.py::TestErrorPublisher::test_no_device_topic_when_device_is_none PASSED [ 45%]
packages/tests/unit/test_errors.py::TestErrorPublisher::test_qos_1_and_retain_false PASSED [ 45%]
packages/tests/unit/test_errors.py::TestErrorPublisher::test_payload_is_valid_json_matching_schema PASSED [ 46%]
packages/tests/unit/test_errors.py::TestErrorPublisher::test_pluggable_error_type_map_flows_through PASSED [ 46%]
packages/tests/unit/test_errors.py::TestErrorPublisher::test_clock_injection_flows_through PASSED [ 46%]
packages/tests/unit/test_errors.py::TestErrorPublisher::test_logs_warning_when_publishing PASSED [ 46%]
packages/tests/unit/test_errors.py::TestSafePublish::test_swallows_mqtt_publish_exception PASSED [ 47%]
packages/tests/unit/test_errors.py::TestSafePublish::test_logs_swallowed_exception PASSED [ 47%]
packages/tests/unit/test_errors.py::TestSafePublish::test_swallows_payload_build_failure PASSED [ 47%]
packages/tests/unit/test_errors.py::TestRootDeviceErrors::test_root_device_skips_per_device_topic PASSED [ 47%]
packages/tests/unit/test_errors.py::TestRootDeviceErrors::test_named_device_still_publishes_both PASSED [ 48%]
packages/tests/unit/test_errors.py::TestRootDeviceErrors::test_root_device_payload_still_includes_device_name PASSED [ 48%]
packages/tests/unit/test_health.py::TestDeviceStatus::test_default_status_is_ok PASSED [ 48%]
packages/tests/unit/test_health.py::TestDeviceStatus::test_custom_status PASSED [ 48%]
packages/tests/unit/test_health.py::TestDeviceStatus::test_to_dict_returns_status_mapping PASSED [ 48%]
packages/tests/unit/test_health.py::TestDeviceStatus::test_frozen_immutable PASSED [ 49%]
packages/tests/unit/test_health.py::TestHeartbeatPayload::test_construction_with_all_fields PASSED [ 49%]
packages/tests/unit/test_health.py::TestHeartbeatPayload::test_to_json_produces_valid_json PASSED [ 49%]
packages/tests/unit/test_health.py::TestHeartbeatPayload::test_default_devices_empty_dict PASSED [ 49%]
packages/tests/unit/test_health.py::TestHeartbeatPayload::test_frozen_immutable PASSED [ 50%]
packages/tests/unit/test_health.py::TestHeartbeatPayload::test_devices_serialised_to_nested_json PASSED [ 50%]
packages/tests/unit/test_health.py::TestBuildWillConfig::test_creates_will_config_with_correct_topic PASSED [ 50%]
packages/tests/unit/test_health.py::TestBuildWillConfig::test_will_config_payload_is_offline PASSED [ 50%]
packages/tests/unit/test_health.py::TestBuildWillConfig::test_will_config_retained_and_qos_1 PASSED [ 51%]
packages/tests/unit/test_health.py::TestHealthReporter::test_publish_device_available_sends_online PASSED [ 51%]
packages/tests/unit/test_health.py::TestHealthReporter::test_publish_device_available_retained_qos_1 PASSED [ 51%]
packages/tests/unit/test_health.py::TestHealthReporter::test_publish_device_available_sets_device_status PASSED [ 51%]
packages/tests/unit/test_health.py::TestHealthReporter::test_publish_device_unavailable_sends_offline PASSED [ 52%]
packages/tests/unit/test_health.py::TestHealthReporter::test_publish_device_unavailable_removes_device PASSED [ 52%]
packages/tests/unit/test_health.py::TestHealthReporter::test_publish_heartbeat_sends_json_to_status_topic PASSED [ 52%]
packages/tests/unit/test_health.py::TestHealthReporter::test_publish_heartbeat_includes_uptime PASSED [ 52%]
packages/tests/unit/test_health.py::TestHealthReporter::test_publish_heartbeat_includes_version PASSED [ 52%]
packages/tests/unit/test_health.py::TestHealthReporter::test_publish_heartbeat_includes_devices PASSED [ 53%]
packages/tests/unit/test_health.py::TestHealthReporter::test_publish_heartbeat_retained PASSED [ 53%]
packages/tests/unit/test_health.py::TestHealthReporter::test_set_device_status_updates_internal_state PASSED [ 53%]
packages/tests/unit/test_health.py::TestHealthReporter::test_remove_device_removes_from_tracking PASSED [ 53%]
packages/tests/unit/test_health.py::TestShutdown::test_shutdown_publishes_offline_for_all_devices PASSED [ 54%]
packages/tests/unit/test_health.py::TestShutdown::test_shutdown_publishes_devices_before_app_status PASSED [ 54%]
packages/tests/unit/test_health.py::TestShutdown::test_shutdown_publishes_offline_status PASSED [ 54%]
packages/tests/unit/test_health.py::TestShutdown::test_shutdown_clears_device_tracking PASSED [ 54%]
packages/tests/unit/test_health.py::TestSafePublish::test_swallows_mqtt_exception PASSED [ 55%]
packages/tests/unit/test_health.py::TestSafePublish::test_logs_swallowed_exception PASSED [ 55%]
packages/tests/unit/test_health.py::TestRootDeviceAvailability::test_root_device_publishes_to_prefix_availability PASSED [ 55%]
packages/tests/unit/test_health.py::TestRootDeviceAvailability::test_root_device_tracked_in_root_set PASSED [ 55%]
packages/tests/unit/test_health.py::TestRootDeviceAvailability::test_root_unavailable_publishes_to_prefix_availability PASSED [ 56%]
packages/tests/unit/test_health.py::TestRootDeviceAvailability::test_shutdown_root_device_correct_topic PASSED [ 56%]
packages/tests/unit/test_health.py::TestRootDeviceAvailability::test_shutdown_mixed_root_and_named PASSED [ 56%]
packages/tests/unit/test_health.py::TestRootDeviceAvailability::test_shutdown_clears_root_devices PASSED [ 56%]
packages/tests/unit/test_injection.py::TestBuildInjectionPlan::test_zero_params_returns_empty_plan PASSED [ 56%]
packages/tests/unit/test_injection.py::TestBuildInjectionPlan::test_single_ctx_param PASSED [ 57%]
packages/tests/unit/test_injection.py::TestBuildInjectionPlan::test_single_settings_param PASSED [ 57%]
packages/tests/unit/test_injection.py::TestBuildInjectionPlan::test_single_logger_param PASSED [ 57%]
packages/tests/unit/test_injection.py::TestBuildInjectionPlan::test_single_clock_param PASSED [ 57%]
packages/tests/unit/test_injection.py::TestBuildInjectionPlan::test_single_event_param PASSED [ 58%]
packages/tests/unit/test_injection.py::TestBuildInjectionPlan::test_multi_params PASSED [ 58%]
packages/tests/unit/test_injection.py::TestBuildInjectionPlan::test_unknown_type_accepted_in_plan PASSED [ 58%]
packages/tests/unit/test_injection.py::TestBuildInjectionPlan::test_missing_annotation_raises_type_error PASSED [ 58%]
packages/tests/unit/test_injection.py::TestBuildInjectionPlan::test_param_name_is_irrelevant PASSED [ 59%]
packages/tests/unit/test_injection.py::TestResolveKwargs::test_empty_plan_returns_empty_kwargs PASSED [ 59%]
packages/tests/unit/test_injection.py::TestResolveKwargs::test_resolves_device_context PASSED [ 59%]
packages/tests/unit/test_injection.py::TestResolveKwargs::test_resolves_settings PASSED [ 59%]
packages/tests/unit/test_injection.py::TestResolveKwargs::test_resolves_logger PASSED [ 60%]
packages/tests/unit/test_injection.py::TestResolveKwargs::test_resolves_clock PASSED [ 60%]
packages/tests/unit/test_injection.py::TestResolveKwargs::test_resolves_shutdown_event PASSED [ 60%]
packages/tests/unit/test_injection.py::TestResolveKwargs::test_resolves_adapter PASSED [ 60%]
packages/tests/unit/test_injection.py::TestResolveKwargs::test_unresolvable_type_raises_type_error PASSED [ 60%]
packages/tests/unit/test_injection.py::TestResolveKwargs::test_resolves_settings_subclass PASSED [ 61%]
packages/tests/unit/test_injection.py::TestResolveKwargs::test_resolves_multiple_types PASSED [ 61%]
packages/tests/unit/test_injection.py::TestBuildProviders::test_contains_all_known_types PASSED [ 61%]
packages/tests/unit/test_injection.py::TestBuildProviders::test_logger_has_device_scoped_name PASSED [ 61%]
packages/tests/unit/test_injection.py::TestBuildProviders::test_adapter_types_included PASSED [ 62%]
packages/tests/unit/test_injection.py::TestBuildProviders::test_settings_subclass_included PASSED [ 62%]
packages/tests/unit/test_injection.py::TestParameterKindValidation::test_injection_plan_rejects_positional_only_param PASSED [ 62%]
packages/tests/unit/test_injection.py::TestParameterKindValidation::test_injection_plan_rejects_var_positional_param PASSED [ 62%]
packages/tests/unit/test_injection.py::TestParameterKindValidation::test_injection_plan_rejects_var_keyword_param PASSED [ 63%]
packages/tests/unit/test_injection.py::TestParameterKindValidation::test_injection_plan_accepts_keyword_only_param PASSED [ 63%]
packages/tests/unit/test_injection.py::TestParameterKindValidation::test_positional_only_mqtt_param_is_skipped_before_kind_check PASSED [ 63%]
packages/tests/unit/test_logging.py::TestJsonFormatter::test_output_is_valid_json PASSED [ 63%]
packages/tests/unit/test_logging.py::TestJsonFormatter::test_has_required_fields PASSED [ 64%]
packages/tests/unit/test_logging.py::TestJsonFormatter::test_timestamp_is_utc_iso8601 PASSED [ 64%]
packages/tests/unit/test_logging.py::TestJsonFormatter::test_service_included PASSED [ 64%]
packages/tests/unit/test_logging.py::TestJsonFormatter::test_version_included_when_set PASSED [ 64%]
packages/tests/unit/test_logging.py::TestJsonFormatter::test_version_omitted_when_empty PASSED [ 64%]
packages/tests/unit/test_logging.py::TestJsonFormatter::test_exception_included_when_present PASSED [ 65%]
packages/tests/unit/test_logging.py::TestJsonFormatter::test_stack_info_included_when_present PASSED [ 65%]
packages/tests/unit/test_logging.py::TestConfigureLogging::test_json_mode_sets_json_formatter PASSED [ 65%]
packages/tests/unit/test_logging.py::TestConfigureLogging::test_text_mode_sets_standard_formatter PASSED [ 65%]
packages/tests/unit/test_logging.py::TestConfigureLogging::test_sets_root_logger_level PASSED [ 66%]
packages/tests/unit/test_logging.py::TestConfigureLogging::test_clears_existing_handlers PASSED [ 66%]
packages/tests/unit/test_logging.py::TestConfigureLogging::test_file_handler_added_when_file_set PASSED [ 66%]
packages/tests/unit/test_logging.py::TestConfigureLogging::test_file_handler_respects_max_file_size_mb PASSED [ 66%]
packages/tests/unit/test_mqtt.py::TestWillConfig::test_frozen_prevents_mutation PASSED [ 67%]
packages/tests/unit/test_mqtt.py::TestWillConfig::test_defaults PASSED   [ 67%]
packages/tests/unit/test_mqtt.py::TestWillConfig::test_custom_values PASSED [ 67%]
packages/tests/unit/test_mqtt.py::TestMqttPortProtocol::test_mqtt_client_satisfies_protocol PASSED [ 67%]
packages/tests/unit/test_mqtt.py::TestMqttPortProtocol::test_mock_mqtt_client_satisfies_protocol PASSED [ 68%]
packages/tests/unit/test_mqtt.py::TestMqttPortProtocol::test_null_mqtt_client_satisfies_protocol PASSED [ 68%]
packages/tests/unit/test_mqtt.py::TestMqttPortProtocol::test_class_missing_publish_does_not_satisfy PASSED [ 68%]
packages/tests/unit/test_mqtt.py::TestMqttLifecycleProtocol::test_mqtt_client_satisfies_lifecycle PASSED [ 68%]
packages/tests/unit/test_mqtt.py::TestMqttLifecycleProtocol::test_mock_mqtt_client_does_not_satisfy_lifecycle PASSED [ 68%]
packages/tests/unit/test_mqtt.py::TestMqttLifecycleProtocol::test_null_mqtt_client_does_not_satisfy_lifecycle PASSED [ 69%]
packages/tests/unit/test_mqtt.py::TestMqttMessageHandlerProtocol::test_mqtt_client_satisfies_message_handler PASSED [ 69%]
packages/tests/unit/test_mqtt.py::TestMqttMessageHandlerProtocol::test_mock_mqtt_client_satisfies_message_handler PASSED [ 69%]
packages/tests/unit/test_mqtt.py::TestMqttMessageHandlerProtocol::test_null_mqtt_client_does_not_satisfy_message_handler PASSED [ 69%]
packages/tests/unit/test_mqtt.py::TestNullMqttClient::test_publish_succeeds_silently PASSED [ 70%]
packages/tests/unit/test_mqtt.py::TestNullMqttClient::test_subscribe_succeeds_silently PASSED [ 70%]
packages/tests/unit/test_mqtt.py::TestMockMqttClientPublish::test_records_publish_tuple PASSED [ 70%]
packages/tests/unit/test_mqtt.py::TestMockMqttClientPublish::test_publish_count_increments PASSED [ 70%]
packages/tests/unit/test_mqtt.py::TestMockMqttClientPublish::test_get_messages_for_filters_by_topic PASSED [ 71%]
packages/tests/unit/test_mqtt.py::TestMockMqttClientSubscribe::test_records_subscription PASSED [ 71%]
packages/tests/unit/test_mqtt.py::TestMockMqttClientSubscribe::test_subscribe_count_increments PASSED [ 71%]
packages/tests/unit/test_mqtt.py::TestMockMqttClientCallbacks::test_on_message_registers_callback PASSED [ 71%]
packages/tests/unit/test_mqtt.py::TestMockMqttClientCallbacks::test_deliver_invokes_callbacks PASSED [ 72%]
packages/tests/unit/test_mqtt.py::TestMockMqttClientCallbacks::test_multiple_callbacks_called_in_order PASSED [ 72%]
packages/tests/unit/test_mqtt.py::TestMockMqttClientCallbacks::test_deliver_does_not_catch_callback_errors PASSED [ 72%]
packages/tests/unit/test_mqtt.py::TestMockMqttClientReset::test_reset_clears_all_state PASSED [ 72%]
packages/tests/unit/test_mqtt.py::TestMockMqttClientReset::test_reset_clears_raise_on_publish PASSED [ 72%]
packages/tests/unit/test_mqtt.py::TestMqttClientLifecycle::test_start_creates_background_task PASSED [ 73%]
packages/tests/unit/test_mqtt.py::TestMqttClientLifecycle::test_stop_cancels_task_and_clears_state PASSED [ 73%]
packages/tests/unit/test_mqtt.py::TestMqttClientLifecycle::test_is_connected_reflects_event PASSED [ 73%]
packages/tests/unit/test_mqtt.py::TestMqttClientLifecycle::test_stop_is_idempotent PASSED [ 73%]
packages/tests/unit/test_mqtt.py::TestMqttClientLifecycle::test_start_is_idempotent_while_running PASSED [ 74%]
packages/tests/unit/test_mqtt.py::TestMqttClientPublish::test_raises_when_not_connected PASSED [ 74%]
packages/tests/unit/test_mqtt.py::TestMqttClientPublish::test_publishes_via_internal_client PASSED [ 74%]
packages/tests/unit/test_mqtt.py::TestMqttClientSubscribe::test_tracks_subscription PASSED [ 74%]
packages/tests/unit/test_mqtt.py::TestMqttClientSubscribe::test_subscribes_immediately_if_connected PASSED [ 75%]
packages/tests/unit/test_mqtt.py::TestMqttClientWill::test_will_config_converted_to_aiomqtt_will PASSED [ 75%]
packages/tests/unit/test_mqtt.py::TestMqttClientWill::test_none_will_means_no_will_arg PASSED [ 75%]
packages/tests/unit/test_mqtt.py::TestMqttClientConnect::test_password_extracted_from_secret_str PASSED [ 75%]
packages/tests/unit/test_mqtt.py::TestMqttClientConnect::test_subscriptions_restored_on_reconnect PASSED [ 76%]
packages/tests/unit/test_mqtt.py::TestMqttClientDispatch::test_dispatches_decoded_payload PASSED [ 76%]
packages/tests/unit/test_mqtt.py::TestMqttClientDispatch::test_skips_none_payload PASSED [ 76%]
packages/tests/unit/test_mqtt.py::TestMqttClientDispatch::test_error_in_callback_logged_not_crashed PASSED [ 76%]
packages/tests/unit/test_mqtt.py::TestMqttClientDispatch::test_multiple_callbacks_called_in_order PASSED [ 76%]
packages/tests/unit/test_mqtt.py::TestMqttClientReconnect::test_reconnects_after_error PASSED [ 77%]
packages/tests/unit/test_mqtt.py::TestMqttClientReconnect::test_exponential_backoff_doubles_delay PASSED [ 77%]
packages/tests/unit/test_mqtt.py::TestMqttClientReconnect::test_backoff_resets_on_successful_connection PASSED [ 77%]
packages/tests/unit/test_mqtt.py::TestMqttClientReconnect::test_jitter_applies_random_factor PASSED [ 77%]
packages/tests/unit/test_package.py::TestPackageStructure::test_package_importable PASSED [ 78%]
packages/tests/unit/test_package.py::TestPackageStructure::test_version_is_string PASSED [ 78%]
packages/tests/unit/test_public_api.py::TestCosalettePublicAPI::test_all_contains_expected_symbols PASSED [ 78%]
packages/tests/unit/test_public_api.py::TestCosalettePublicAPI::test_all_symbols_importable PASSED [ 78%]
packages/tests/unit/test_router.py::TestExtractDevice::test_valid_command_topic PASSED [ 79%]
packages/tests/unit/test_router.py::TestExtractDevice::test_non_set_suffix_ignored PASSED [ 79%]
packages/tests/unit/test_router.py::TestExtractDevice::test_missing_prefix PASSED [ 79%]
packages/tests/unit/test_router.py::TestExtractDevice::test_nested_device_path PASSED [ 79%]
packages/tests/unit/test_router.py::TestExtractDevice::test_empty_device_name PASSED [ 80%]
packages/tests/unit/test_router.py::TestExtractDevice::test_prefix_only PASSED [ 80%]
packages/tests/unit/test_router.py::TestExtractDevice::test_exact_prefix_match PASSED [ 80%]
packages/tests/unit/test_router.py::TestRegister::test_register_handler PASSED [ 80%]
packages/tests/unit/test_router.py::TestRegister::test_duplicate_raises_value_error PASSED [ 80%]
packages/tests/unit/test_router.py::TestRoute::test_routes_to_correct_handler PASSED [ 81%]
packages/tests/unit/test_router.py::TestRoute::test_unknown_device_logs_warning PASSED [ 81%]
packages/tests/unit/test_router.py::TestRoute::test_non_command_topic_silently_ignored PASSED [ 81%]
packages/tests/unit/test_router.py::TestRoute::test_routes_to_correct_handler_multiple_devices PASSED [ 81%]
packages/tests/unit/test_router.py::TestRoute::test_handler_receives_correct_arguments PASSED [ 82%]
packages/tests/unit/test_router.py::TestSubscriptions::test_empty_router_returns_empty_list PASSED [ 82%]
packages/tests/unit/test_router.py::TestSubscriptions::test_returns_subscription_topics PASSED [ 82%]
packages/tests/unit/test_router.py::TestRootDevice::test_register_root_handler PASSED [ 82%]
packages/tests/unit/test_router.py::TestRootDevice::test_route_root_topic PASSED [ 83%]
packages/tests/unit/test_router.py::TestRootDevice::test_root_subscription PASSED [ 83%]
packages/tests/unit/test_router.py::TestRootDevice::test_duplicate_root_raises PASSED [ 83%]
packages/tests/unit/test_router.py::TestRootDevice::test_root_and_named_coexist PASSED [ 83%]
packages/tests/unit/test_router.py::TestRootDevice::test_root_topic_no_handler_logs_warning PASSED [ 84%]
packages/tests/unit/test_settings.py::TestMqttSettingsDefaults::test_host_defaults_to_localhost PASSED [ 84%]
packages/tests/unit/test_settings.py::TestMqttSettingsDefaults::test_port_defaults_to_1883 PASSED [ 84%]
packages/tests/unit/test_settings.py::TestMqttSettingsDefaults::test_username_defaults_to_none PASSED [ 84%]
packages/tests/unit/test_settings.py::TestMqttSettingsDefaults::test_password_defaults_to_none PASSED [ 84%]
packages/tests/unit/test_settings.py::TestMqttSettingsDefaults::test_client_id_defaults_to_empty PASSED [ 85%]
packages/tests/unit/test_settings.py::TestMqttSettingsDefaults::test_reconnect_interval_defaults_to_5 PASSED [ 85%]
packages/tests/unit/test_settings.py::TestMqttSettingsDefaults::test_reconnect_max_interval_defaults_to_300 PASSED [ 85%]
packages/tests/unit/test_settings.py::TestMqttSettingsDefaults::test_qos_defaults_to_1 PASSED [ 85%]
packages/tests/unit/test_settings.py::TestMqttSettingsDefaults::test_topic_prefix_defaults_to_empty PASSED [ 86%]
packages/tests/unit/test_settings.py::TestMqttSettingsValidation::test_port_zero_is_invalid PASSED [ 86%]
packages/tests/unit/test_settings.py::TestMqttSettingsValidation::test_port_65536_is_invalid PASSED [ 86%]
packages/tests/unit/test_settings.py::TestMqttSettingsValidation::test_port_1_is_valid PASSED [ 86%]
packages/tests/unit/test_settings.py::TestMqttSettingsValidation::test_port_65535_is_valid PASSED [ 87%]
packages/tests/unit/test_settings.py::TestMqttSettingsValidation::test_reconnect_interval_zero_is_invalid PASSED [ 87%]
packages/tests/unit/test_settings.py::TestMqttSettingsValidation::test_reconnect_interval_negative_is_invalid PASSED [ 87%]
packages/tests/unit/test_settings.py::TestMqttSettingsValidation::test_reconnect_max_interval_zero_is_invalid PASSED [ 87%]
packages/tests/unit/test_settings.py::TestMqttSettingsValidation::test_reconnect_max_interval_negative_is_invalid PASSED [ 88%]
packages/tests/unit/test_settings.py::TestMqttSettingsValidation::test_qos_3_is_invalid PASSED [ 88%]
packages/tests/unit/test_settings.py::TestMqttSettingsSecretStr::test_password_is_secret_str PASSED [ 88%]
packages/tests/unit/test_settings.py::TestMqttSettingsSecretStr::test_password_str_does_not_expose_value PASSED [ 88%]
packages/tests/unit/test_settings.py::TestMqttSettingsSecretStr::test_password_get_secret_value PASSED [ 88%]
packages/tests/unit/test_settings.py::TestLoggingSettingsDefaults::test_level_defaults_to_info PASSED [ 89%]
packages/tests/unit/test_settings.py::TestLoggingSettingsDefaults::test_format_defaults_to_json PASSED [ 89%]
packages/tests/unit/test_settings.py::TestLoggingSettingsDefaults::test_file_defaults_to_none PASSED [ 89%]
packages/tests/unit/test_settings.py::TestLoggingSettingsDefaults::test_backup_count_defaults_to_3 PASSED [ 89%]
packages/tests/unit/test_settings.py::TestLoggingSettingsValidation::test_invalid_level_rejected PASSED [ 90%]
packages/tests/unit/test_settings.py::TestLoggingSettingsValidation::test_invalid_format_rejected PASSED [ 90%]
packages/tests/unit/test_settings.py::TestLoggingSettingsValidation::test_negative_backup_count_rejected PASSED [ 90%]
packages/tests/unit/test_settings.py::TestSettingsDefaults::test_mqtt_is_mqtt_settings_instance PASSED [ 90%]
packages/tests/unit/test_settings.py::TestSettingsDefaults::test_logging_is_logging_settings_instance PASSED [ 91%]
packages/tests/unit/test_settings.py::TestSettingsDefaults::test_mqtt_defaults_propagate PASSED [ 91%]
packages/tests/unit/test_settings.py::TestSettingsDefaults::test_logging_defaults_propagate PASSED [ 91%]
packages/tests/unit/test_settings.py::TestSettingsEnvOverride::test_mqtt_host_from_env PASSED [ 91%]
packages/tests/unit/test_settings.py::TestSettingsEnvOverride::test_logging_level_from_env PASSED [ 92%]
packages/tests/unit/test_settings.py::TestSettingsEnvOverride::test_mqtt_port_from_env PASSED [ 92%]
packages/tests/unit/test_settings.py::TestSettingsEnvOverride::test_mqtt_password_from_env PASSED [ 92%]
packages/tests/unit/test_settings.py::TestSettingsNestedDelimiter::test_double_underscore_delimiter PASSED [ 92%]
packages/tests/unit/test_testing_module.py::TestPublicAPI::test_all_contains_expected_symbols PASSED [ 92%]
packages/tests/unit/test_testing_module.py::TestPublicAPI::test_all_symbols_importable PASSED [ 93%]
packages/tests/unit/test_testing_module.py::TestFakeClock::test_default_time_is_zero PASSED [ 93%]
packages/tests/unit/test_testing_module.py::TestFakeClock::test_custom_initial_time PASSED [ 93%]
packages/tests/unit/test_testing_module.py::TestFakeClock::test_time_can_be_updated PASSED [ 93%]
packages/tests/unit/test_testing_module.py::TestFakeClock::test_satisfies_clock_port PASSED [ 94%]
packages/tests/unit/test_testing_module.py::TestMakeSettings::test_returns_settings_instance PASSED [ 94%]
packages/tests/unit/test_testing_module.py::TestMakeSettings::test_defaults_mqtt_host_localhost PASSED [ 94%]
packages/tests/unit/test_testing_module.py::TestMakeSettings::test_defaults_mqtt_port_1883 PASSED [ 94%]
packages/tests/unit/test_testing_module.py::TestMakeSettings::test_accepts_overrides PASSED [ 95%]
packages/tests/unit/test_testing_module.py::TestMakeSettings::test_ignores_ambient_env_vars PASSED [ 95%]
packages/tests/unit/test_testing_module.py::TestMakeSettings::test_ignores_nested_env_vars PASSED [ 95%]
packages/tests/unit/test_testing_module.py::TestMakeSettings::test_overrides_win_over_env_vars PASSED [ 95%]
packages/tests/unit/test_testing_module.py::TestReExports::test_mock_mqtt_client_identity PASSED [ 96%]
packages/tests/unit/test_testing_module.py::TestReExports::test_null_mqtt_client_identity PASSED [ 96%]
packages/tests/unit/test_testing_module.py::TestAppHarness::test_create_returns_harness_instance PASSED [ 96%]
packages/tests/unit/test_testing_module.py::TestAppHarness::test_create_defaults_name_and_version PASSED [ 96%]
packages/tests/unit/test_testing_module.py::TestAppHarness::test_create_custom_name_version PASSED [ 96%]
packages/tests/unit/test_testing_module.py::TestAppHarness::test_create_settings_overrides PASSED [ 97%]
packages/tests/unit/test_testing_module.py::TestAppHarness::test_mqtt_is_mock_instance PASSED [ 97%]
packages/tests/unit/test_testing_module.py::TestAppHarness::test_clock_is_fake_instance PASSED [ 97%]
packages/tests/unit/test_testing_module.py::TestAppHarness::test_shutdown_event_initially_not_set PASSED [ 97%]
packages/tests/unit/test_testing_module.py::TestAppHarness::test_trigger_shutdown_sets_event PASSED [ 98%]
packages/tests/unit/test_testing_module.py::TestAppHarness::test_create_dry_run_mode PASSED [ 98%]
packages/tests/unit/test_testing_module.py::TestAppHarness::test_run_executes_device PASSED [ 98%]
packages/tests/unit/test_testing_module.py::TestPytestPlugin::test_mock_mqtt_fixture_returns_mock PASSED [ 98%]
packages/tests/unit/test_testing_module.py::TestPytestPlugin::test_fake_clock_fixture_returns_fake PASSED [ 99%]
packages/tests/unit/test_testing_module.py::TestPytestPlugin::test_device_context_fixture_returns_context PASSED [ 99%]
packages/tests/unit/test_testing_module.py::TestPytestPlugin::test_device_context_has_test_defaults PASSED [ 99%]
packages/tests/unit/test_testing_module.py::TestPytestPlugin::test_device_context_uses_mock_mqtt PASSED [ 99%]
packages/tests/unit/test_testing_module.py::TestPytestPlugin::test_fixtures_are_fresh_per_test PASSED [100%]
============================= 425 passed in 3.56s ==============================
```

```bash
cd /workspace && task lint 2>&1 | tail -5 && task typecheck 2>&1 | tail -3
```

```output
task: [lint] uv run ruff check packages/src/ packages/tests/
All checks passed!
task: [lint] uv run ruff format --check packages/src/ packages/tests/
41 files already formatted
task: [typecheck] uv run mypy packages/src/
Success: no issues found in 18 source files
```
